

# Taizyd Korambayil SDGM-560 Blog
## Week 1 - Transition Effect Prototype _09/14/2018_

For the first week as we as a group decided on what the project would be and the kind of effect we are doing. Since we are dealing with 
a transition effect where a car transforms from and old model into another I decided to do a quick prototype shader in UE4 that we could use as a Previs element in out pitch.

![Shader](img/ShaderTest.gif)

The shader is essentially driven by a linear gradient generated from the Forward Vector of a Location Blueprint. The geometry is masked and swapped based on which side of the locator BP it is on.

**Shader Nodes**
![TestShader](img/prototypeshader.png)

The Location of the Blueprint Actor is fed into the shader using a Material Parameter Collection fo Convenience.

**BP Locator Setup**
![LocatorBP](img/locatorBP.png)

For the final effect we intend to make use of Houdini's game sheld tools to bake out Pivot Points and also bring in cached geometry animation from houdini and implement these in Unreal using shaders and Blueprints to drive them in real time.

**FX Reference** <BR>            
![ref01](img/fxref_01.gif) 
![ref02](img/fxref_02.gif)
![ref03](img/fxref_03.gif) 
![ref04](img/fxref_04.gif)
![ref05](img/fxref_05.gif) 
![ref05](img/fxref_06.gif)
  
## Week 2 - Pivot Painter R&D _09/25/2018_

This week I spent some time looking into the Game Shelf Tools in Houdini, specifically the **Pivot Painter SOP**. I used this tool to bake out seperate pivot locations for each poly on the surface of the car into the UV channels, and accessed them in unreal to create the dissappation effect. The limit with this effect is that it is dictated by the topology of the Mesh.

**Test on Car Model**
![ref05](img/cartest06.gif)
![ref05](img/cartest04.gif)
![ref05](img/cartest03.gif)

**Houdini Setup**
Below you can see the setup I am using to bake pivot locations to each face, I scatter points at the center of each poly, and transfer a name attribute to the points that make up each primitve so it knows which scattered point to use as it's pivot. The Pivot Painter SOP then bakes these locations into additional UV channels of the mesh.

**Network**<BR>
![ref01](img/pivotpainter_network.png)
![ref01](img/pivotpainter.png)

**Setup in Unreal Engine**
In Unreal I modified my Shader from last week to make use of the baked pivot locations to displace the polys based on the location of the blueprint to drive the Transition. There are Parameters to control Displacement Amt, Falloff and Effect Radius.<BR>

Displacement Amt: 32
![ref05](img/robertotopighead_02.gif)

Displacement Amt: 512
![ref05](img/robertotopighead.gif) 

Shader Network:
![ref01](img/pivotpaintershader.png)

**Troubleshooting:**
The Pivot Painter SOP sometimes still exports geometry with incorrect Pivot Locations and flipped faces, resulting in unclean geometry inside unreal.

**Next Step:**<BR>
1.Try and export pivot locations for each part of the car so that we can prototype the Disassmbly type effect that was suggested by Todd last week.<BR>
2.Try exporting out vertex animations from houdini instead of driving the effect procedurally in unreal.

## Week 3 - FX Update, Piece chunking, Variation _10/02/2018_

This week I spent some trying to implement Todd's suggestion of having individual pieces of the car disassmble and reassemble. For this I needed to update my houdini setup to chunk pieces together and assign the same pivot location for each piece. I also tried a quick variation shader in UE4 where the car would swirl and morph into the other.

![ref01](img/Render_V1.gif)
![ref01](img/Render_V2.gif)
![ref01](img/Render_V3.gif)

# Houdini Setup Update
I had modify my houdini setup to account for chunking and find a way to scatter the pivot location points at the center of each group.For now I am using spherical normals for the pivot direction, which is what casues all hte pieces to fly out in an outward spherical direction. Moving forward these will be grouped to work better gor how we want the effect to play out.
Groups Visualized:
![ref01](img/groupsvisualized.png)
<BR>Scattered Pivots Visualized:
![ref01](img/pivotpointsvisualized.png)

**Network**<BR>
![ref01](img/updatedhoudininetwork.png)
<BR>Below is the VEX code that scatters points at the centroid of each group.
![ref01](img/centroidvex.png)
<BR>And below is the VEX code for creating groups from attributes, in this case using the @class variable generated by the connectivity Node.<BR>
![ref01](img/groupsfromattributes.png)
  
# UE4 Setup updates

In unreal I updated the technique I was using to drive the transition, instead of using the forward vector of one blueprint to drive the transition mask, I switched to using a linear gradient generated from the distance between a **BPstartLocator** and a **BPEndlocator**. This allowed to drive the transition from any 3 dimensional axis we want instead of being limited to the XY plane with the old technique.

Different Axis<BR>
![ref01](img/axis_01.gif)

Influence Radius<BR>
![ref01](img/influenceradius.gif)
  
# Updated shader Network

I've updated the shader to have more parameters to control the final look of the effect in realtime, like influence radius, Displacement Amount, Enable/disable Rotation, Falloff etc.

**Shader Network**

![ref01](img/shaderupdate.png)

Parameter List:<BR>
![ref01](img/parameterlist.png)
![ref01](img/parameterlist2.png)

# Next Steps
1. Start Working on Look-Dev for the effect, more elements.
2. Wrap shader into Material Function for easy layering onto any surface shader
3. Try some more variations on transition effect
4. Try Simple composition in Nuke with shaded Models from Haley and Brian.
5. Implement feedback from this week.

# Week 4 - Houdini Troubleshooting, Transition Variation _10/09/2018_

This week has mostly been troubleshooting on my end, moving individual pieces by hand and transferring data from the processed mesh to the Final Shaded Mesh, is proving a little difficult as the Mesh Topology has changed on the actual mesh. So this may require a little bit of backtracking on my end, as well as redoing some of the tedious bits by hand.

The other problem was getting houdini to export the model with the Assigned Material ID's, the obj format reads Material ID's into houdini but when exporting FBX the the Material ID's would not transfer, so that required a bit of wrangling.

**Below I'm moving individual pieces by hand to get more deifned movement**<BR>

![ref01](img/seperatepieces.png)<BR>

**Pivot rotation based in location in space**<BR>

![ref01](img/explodedpiecenormal.png)<BR>

**Vex Code to set normal rotation based on location in space**

![ref01](img/setnormalsbasedonlocationinspace.png)<BR>
  
**Pivot locations Transferred to pieces on base model**

![ref01](img/transferrednormalsfromexplodedmesh.png)<BR>
  
**Car Schematic View**
This was a test for aholographic schematic view of the car. The idea is to have the car transition into this schematic view before the pieces fly away to try and sell the original effect better.

![ref01](img/schematicview.gif)<BR>
  
## Transition Shader Variation

Since a lot of my work this week had been trouble shooting, I needed to take abreak and work on something else, so I created a variaiton on the shader based transition effect.

**Sequence Breakdown**
![ref01](img/shadergif1.gif)<BR>
![ref01](img/shadergif2.gif)<BR>
![ref01](img/shadergif3.gif)<BR>
  
![ref01](img/TeleportGif.gif)<BR>
  
**Shader Network**

![ref01](img/teleshader.png)<BR>

**Custom Function**

![ref01](img/matrixnoisefunction.png)<BR>
  
# Next Steps
1. Start Working on Look-Dev for the effect, more elements.
2. Try some more variations on transition effect
3. Try Simple composition in Nuke with shaded Models from Haley and Brian.
4. Implement feedback from this week.
  








 
